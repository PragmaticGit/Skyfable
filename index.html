<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyFable - Weather-Based Game Discovery</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Quicksand', sans-serif; 
            margin: 0; 
        }
        .star-sparkle {
            position: absolute;
            color: #FFF099;
            animation: sparkle 2s ease-in-out infinite;
            font-size: 24px;
        }
        @keyframes sparkle {
            0%, 100% { opacity: 0.4; transform: scale(1) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.3) rotate(180deg); }
        }
        .diamond-sparkle {
            width: 20px;
            height: 20px;
            background: #FFF099;
            transform: rotate(45deg);
            position: absolute;
            animation: sparkle 2.5s ease-in-out infinite;
        }
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        .loading-spin {
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(45deg); }
            100% { transform: rotate(405deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const SkyFable = () => {
          const [currentScreen, setCurrentScreen] = useState('landing');
          const [weather, setWeather] = useState(null);
          const [location, setLocation] = useState(null);
          const [gameRecommendation, setGameRecommendation] = useState(null);
          const [loadingProgress, setLoadingProgress] = useState(0);

          // Enhanced game database
          const gameDatabase = {
            rain: [
              {
                title: "Firewatch",
                tags: ["Single-player", "Atmospheric", "Story-Rich"],
                description: "Today's drizzle sets the mood for something quiet and reflective. Firewatch is a first-person mystery in the Wyoming wilderness, where your only lifeline is a voice on the other end of a radio. If you're in the mood for a scenic walk and a story that lingers, this is the perfect rainy day pick",
                reasoning: "Rainy weather calls for introspective, slower-paced experiences"
              },
              {
                title: "Stardew Valley",
                tags: ["Farming", "Relaxing", "Pixel Art"],
                description: "There's something magical about tending virtual crops while real rain nourishes the world outside. The cozy pixel art and gentle gameplay create the perfect indoor sanctuary.",
                reasoning: "Indoor comfort gaming for rainy day coziness"
              },
              {
                title: "Coffee Talk",
                tags: ["Narrative", "Chill", "Music"],
                description: "Listen to customers' stories while brewing the perfect coffee. The rainy atmosphere outside matches the warm, intimate café setting perfectly.",
                reasoning: "Cozy café vibes perfect for rainy evenings"
              }
            ],
            sunny: [
              {
                title: "No Man's Sky",
                tags: ["Space", "Exploration", "Colorful"],
                description: "Brilliant sunshine deserves brilliant alien worlds! Your sunny mood is perfect for exploring vibrant planets, discovering new species, and building bases under exotic skies.",
                reasoning: "Bright, expansive experiences that match sunny energy"
              },
              {
                title: "Horizon Zero Dawn",
                tags: ["Action", "Open World", "Epic"],
                description: "Sunny weather gives you energy for epic adventures! Join Aloy as she explores stunning post-apocalyptic landscapes with gorgeous outdoor environments.",
                reasoning: "High-energy adventures that match sunny day motivation"
              }
            ],
            cloudy: [
              {
                title: "What Remains of Edith Finch",
                tags: ["Narrative", "Atmospheric", "Mystery"],
                description: "Overcast skies create the perfect backdrop for mysterious stories. This hauntingly beautiful narrative adventure thrives in contemplative cloudy weather.",
                reasoning: "Mysterious, atmospheric games for contemplative cloudy moods"
              }
            ],
            snow: [
              {
                title: "The Long Dark",
                tags: ["Survival", "Winter", "Atmospheric"],
                description: "Snowy weather calls for the ultimate winter survival experience! Feel the chill alongside your character as you navigate the Canadian wilderness.",
                reasoning: "Immersive winter experiences that complement snowy conditions"
              }
            ],
            clear: [
              {
                title: "Journey",
                tags: ["Transcendent", "Beautiful", "Meditative"],
                description: "Clear skies inspire clear journeys of the soul. This wordless adventure through mystical landscapes captures the sense of possibility that comes with perfect weather.",
                reasoning: "Transcendent experiences for perfect weather days"
              }
            ]
          };

          const getWeatherType = (condition, temp = 20) => {
            const lowerCondition = condition.toLowerCase();
            
            if (lowerCondition.includes('rain') || lowerCondition.includes('drizzle') || 
                lowerCondition.includes('shower') || lowerCondition.includes('storm')) {
              return 'rain';
            }
            if (lowerCondition.includes('snow') || lowerCondition.includes('blizzard')) {
              return 'snow';
            }
            if (lowerCondition.includes('cloud') || lowerCondition.includes('overcast')) {
              return 'cloudy';
            }
            if (lowerCondition.includes('sun') || lowerCondition.includes('clear') || (temp > 25)) {
              return 'sunny';
            }
            
            return 'clear';
          };

          const fetchWeather = async (lat, lon) => {
            try {
              const response = await fetch(`https://wttr.in/${lat},${lon}?format=j1`);
              
              if (!response.ok) {
                throw new Error('Weather fetch failed');
              }
              
              const data = await response.json();
              const current = data.current_condition[0];
              const location = data.nearest_area[0];
              
              return {
                weather: [{ 
                  main: current.weatherDesc[0].value,
                  description: current.weatherDesc[0].value.toLowerCase()
                }],
                name: location.areaName[0].value,
                main: { 
                  temp: parseInt(current.temp_C)
                }
              };
            } catch (error) {
              console.error('Weather API failed, using fallback:', error);
              return {
                weather: [{ main: 'Rain', description: 'rainy evening' }],
                name: 'Stavanger',
                main: { temp: 18 }
              };
            }
          };

          const getLocation = () => {
            return new Promise((resolve, reject) => {
              if (!navigator.geolocation) {
                resolve({ lat: 59.9139, lon: 10.7522 });
                return;
              }

              navigator.geolocation.getCurrentPosition(
                (position) => {
                  resolve({
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                  });
                },
                (error) => {
                  resolve({ lat: 59.9139, lon: 10.7522 });
                }
              );
            });
          };

          const handleForecastClick = async () => {
            setCurrentScreen('loading');
            setLoadingProgress(0);

            const progressInterval = setInterval(() => {
              setLoadingProgress(prev => {
                if (prev >= 90) {
                  clearInterval(progressInterval);
                  return 90;
                }
                return prev + Math.random() * 15;
              });
            }, 300);

            try {
              const userLocation = await getLocation();
              setLocation(userLocation);

              const weatherData = await fetchWeather(userLocation.lat, userLocation.lon);
              setWeather(weatherData);

              const weatherType = getWeatherType(weatherData.weather[0].main, weatherData.main.temp);
              const availableGames = gameDatabase[weatherType] || gameDatabase.clear;
              const randomGame = availableGames[Math.floor(Math.random() * availableGames.length)];
              setGameRecommendation(randomGame);

              setTimeout(() => {
                setLoadingProgress(100);
                setTimeout(() => {
                  setCurrentScreen('result');
                }, 800);
              }, 2000);

            } catch (error) {
              console.error('Error fetching data:', error);
              const fallbackGame = gameDatabase.rain[0];
              setGameRecommendation(fallbackGame);
              setTimeout(() => {
                setLoadingProgress(100);
                setTimeout(() => {
                  setCurrentScreen('result');
                }, 800);
              }, 2000);
            }
          };

          const handleRollAgain = () => {
            if (weather) {
              const weatherType = getWeatherType(weather.weather[0].main, weather.main.temp);
              const availableGames = gameDatabase[weatherType] || gameDatabase.clear;
              const randomGame = availableGames[Math.floor(Math.random() * availableGames.length)];
              setGameRecommendation(randomGame);
            }
          };

          // Load initial weather data
          useEffect(() => {
            const loadInitialWeather = async () => {
              try {
                const userLocation = await getLocation();
                setLocation(userLocation);
                const weatherData = await fetchWeather(userLocation.lat, userLocation.lon);
                setWeather(weatherData);
              } catch (error) {
                console.error('Failed to load initial weather:', error);
              }
            };

            loadInitialWeather();
          }, []);

          const renderLanding = () => (
            <div className="min-h-screen relative overflow-hidden" style={{
              backgroundColor: '#837EB4'
            }}>
              {/* Navigation */}
              <nav className="flex justify-between items-center px-8 py-6 relative z-10" style={{
                backgroundColor: '#504B81'
              }}>
                <div className="text-white text-2xl font-bold">
                  Sky<span style={{color: '#FFF099'}}>Fable</span>
                </div>
                <button 
                  onClick={handleForecastClick}
                  className="px-6 py-3 border-2 rounded-lg font-semibold transition-all duration-300 hover:scale-105"
                  style={{
                    borderColor: '#FFF099',
                    color: '#FFF099',
                    backgroundColor: 'transparent'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.backgroundColor = '#FFF099';
                    e.target.style.color = '#504B81';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.backgroundColor = 'transparent';
                    e.target.style.color = '#FFF099';
                  }}
                >
                  Forecast My Game
                </button>
              </nav>

              {/* Main Content */}
              <div className="flex items-center justify-between px-8 py-16 max-w-7xl mx-auto relative z-10">
                {/* Left Content */}
                <div className="flex-1 pr-16">
                  <h1 className="text-5xl md:text-6xl font-bold mb-6 leading-tight" style={{color: '#FFF099'}}>
                    Find the perfect game based on your local weather
                  </h1>
                  
                  <p className="text-xl mb-8 text-white opacity-90 font-medium leading-relaxed">
                    Right now in <span className="font-bold">{weather?.name || 'Stavanger'}</span>, It's a{' '}
                    <span className="font-bold" style={{color: '#FFF099'}}>
                      {weather ? weather.weather[0].description : 'rainy evening'}
                    </span>{' '}
                    so it's time for something quiet and reflective 🌧️
                  </p>

                  <button 
                    onClick={handleForecastClick}
                    className="px-8 py-4 rounded-lg font-bold text-lg transition-all duration-300 hover:scale-105 shadow-lg"
                    style={{
                      backgroundColor: '#FFF099',
                      color: '#504B81'
                    }}
                  >
                    Forecast My Game
                  </button>
                </div>

                {/* Right Content - Your Hero Image */}
                <div className="flex-1 flex justify-center">
                  <div className="relative">
                    <img 
                      src="./images/Hero Image.png" 
                      alt="Gaming illustration" 
                      className="max-w-full h-auto rounded-2xl shadow-2xl"
                      style={{maxHeight: '400px'}}
                    />
                  </div>
                </div>
              </div>

              {/* Decorative Elements */}
              <div className="star-sparkle" style={{top: '25%', right: '15%', animationDelay: '0s'}}>✨</div>
              <div className="diamond-sparkle" style={{top: '20%', left: '20%', animationDelay: '0.5s'}}></div>
              <div className="star-sparkle" style={{top: '40%', right: '25%', animationDelay: '1s'}}>⭐</div>
              <div className="diamond-sparkle" style={{bottom: '30%', right: '10%', animationDelay: '1.5s'}}></div>
            </div>
          );

          const renderLoading = () => (
            <div className="min-h-screen relative flex flex-col" style={{
              backgroundColor: '#837EB4'
            }}>
              {/* Navigation */}
              <nav className="flex justify-between items-center px-8 py-6" style={{
                backgroundColor: '#504B81'
              }}>
                <div className="text-white text-2xl font-bold">
                  Sky<span style={{color: '#FFF099'}}>Fable</span>
                </div>
                <button 
                  className="px-6 py-3 border-2 rounded-lg font-semibold opacity-50 cursor-not-allowed"
                  style={{
                    borderColor: '#FFF099',
                    color: '#FFF099'
                  }}
                >
                  Forecast My Game
                </button>
              </nav>

              {/* Loading Content */}
              <div className="flex-1 flex flex-col items-center justify-center px-8">
                <h1 className="text-5xl md:text-6xl font-bold mb-8 text-white text-center">
                  Sky<span style={{color: '#FFF099'}}>Fable</span>
                </h1>
                
                <p className="text-2xl mb-16 text-center font-medium pulse-animation" style={{color: '#FFF099'}}>
                  Contacting the nearest cloud spirit and<br />
                  matching you with the perfect game...
                </p>

                {/* Loading Image/Animation */}
                <div className="mb-8">
                  <img 
                    src="./images/Loading Gif.png" 
                    alt="Loading animation" 
                    className="w-24 h-24 loading-spin"
                  />
                </div>
              </div>
            </div>
          );

          const renderResult = () => (
            <div className="min-h-screen relative overflow-hidden" style={{
              background: 'linear-gradient(180deg, #F59E0B 0%, #D97706 20%, #837EB4 60%, #504B81 100%)'
            }}>
              {/* Forest Silhouette */}
              <div className="absolute bottom-0 left-0 right-0 h-40" style={{color: 'rgba(0,0,0,0.3)'}}>
                <svg viewBox="0 0 1200 160" className="w-full h-full">
                  <path d="M0,160 L0,100 L60,30 L120,100 L180,40 L240,100 L300,50 L360,100 L420,35 L480,100 L540,45 L600,100 L660,30 L720,100 L780,50 L840,100 L900,40 L960,100 L1020,35 L1080,100 L1140,45 L1200,100 L1200,160 Z" fill="currentColor"/>
                </svg>
              </div>

              {/* Navigation */}
              <nav className="flex justify-between items-center px-8 py-6 relative z-10" style={{
                backgroundColor: 'rgba(80, 75, 129, 0.9)',
                backdropFilter: 'blur(10px)'
              }}>
                <div className="text-white text-2xl font-bold">
                  Sky<span style={{color: '#FFF099'}}>Fable</span>
                </div>
                <button 
                  onClick={() => setCurrentScreen('landing')}
                  className="px-6 py-3 border-2 rounded-lg font-semibold transition-all duration-300"
                  style={{
                    borderColor: '#FFF099',
                    color: '#FFF099'
                  }}
                >
                  Forecast My Game
                </button>
              </nav>

              {/* Game Result */}
              <div className="flex items-center justify-between px-8 py-16 max-w-7xl mx-auto relative z-10">
                {/* Game Card */}
                <div className="flex-shrink-0 mr-16">
                  <div 
                    className="w-80 h-96 rounded-lg shadow-2xl overflow-hidden relative"
                    style={{
                      background: 'linear-gradient(135deg, #F59E0B 0%, #D97706 50%, #B45309 100%)'
                    }}
                  >
                    <div className="absolute inset-0 flex flex-col items-center justify-center text-center p-8">
                      <div className="text-7xl mb-6">🔥</div>
                      <h3 className="text-2xl font-bold text-white mb-4 tracking-wide">
                        {gameRecommendation?.title?.toUpperCase() || 'FIREWATCH'}
                      </h3>
                      <div className="text-orange-100 font-medium text-sm leading-relaxed">
                        A atmospheric walking simulator set in the Wyoming wilderness
                      </div>
                    </div>
                  </div>
                </div>

                {/* Game Info */}
                <div className="flex-1">
                  {/* Tags */}
                  <div className="flex flex-wrap gap-3 mb-6">
                    {(gameRecommendation?.tags || ['Single-player', 'Atmospheric', 'Story-Rich']).map((tag, index) => (
                      <span 
                        key={index}
                        className="px-4 py-2 rounded-full text-sm font-semibold"
                        style={{
                          backgroundColor: '#FFF8CC',
                          color: '#504B81'
                        }}
                      >
                        {tag}
                      </span>
                    ))}
                  </div>

                  {/* Game Title */}
                  <h2 className="text-5xl md:text-6xl font-bold mb-6" style={{color: '#FFF099'}}>
                    {gameRecommendation?.title || 'Firewatch'}
                  </h2>

                  {/* Description */}
                  <p className="text-white text-lg leading-relaxed mb-8 opacity-90 font-medium">
                    {gameRecommendation?.description || "Today's drizzle sets the mood for something quiet and reflective. Firewatch is a first-person mystery in the Wyoming wilderness, where your only lifeline is a voice on the other end of a radio. If you're in the mood for a scenic walk and a story that lingers, this is the perfect rainy day pick"}
                  </p>

                  {/* Action Buttons */}
                  <div className="flex gap-4">
                    <button 
                      className="px-8 py-3 rounded-lg font-bold transition-all duration-300 hover:scale-105 shadow-lg"
                      style={{
                        backgroundColor: '#FFF099',
                        color: '#504B81'
                      }}
                    >
                      View On Steam
                    </button>
                    <button 
                      onClick={handleRollAgain}
                      className="px-8 py-3 border-2 rounded-lg font-bold transition-all duration-300"
                      style={{
                        borderColor: '#FFF8CC',
                        color: '#FFF8CC',
                        backgroundColor: 'transparent'
                      }}
                      onMouseEnter={(e) => {
                        e.target.style.backgroundColor = '#FFF8CC';
                        e.target.style.color = '#504B81';
                      }}
                      onMouseLeave={(e) => {
                        e.target.style.backgroundColor = 'transparent';
                        e.target.style.color = '#FFF8CC';
                      }}
                    >
                      Roll Again
                    </button>
                  </div>
                </div>
              </div>
            </div>
          );

          switch (currentScreen) {
            case 'loading':
              return renderLoading();
            case 'result':
              return renderResult();
            default:
              return renderLanding();
          }
        };

        ReactDOM.render(React.createElement(SkyFable), document.getElementById('root'));
    </script>
</body>
</html>
